/**
 * Copyright (C) 2011-2017 Barchart, Inc. <http://www.barchart.com/>
 *
 * All rights reserved. Licensed under the OSI BSD License.
 *
 * http://www.opensource.org/licenses/bsd-license.php
 */

syntax = "proto3";

package org.openfeed;

option java_multiple_files = true;
option java_generate_equals_and_hash = true;
option optimize_for = SPEED;

import "instrument.proto";

/// A wrapper for Openfeed data.  Will contain exactly one of the supported
// message types
message OpenfeedMessage {

  /// Nanoecond unix epoch at time of message transmission (UTC)
  sint64 sendingTime = 1;

  /// The total number of markets available on this channel
  // at the time the message was sent.  For UDP snapshot and definition feeds.
  sint32 totalCount = 2;

  /// The most recent packet sequence number sent on the incremental feed
  // at the time this message was sent.  For UDP snapshot and definition feeds.
  int64 syncSequence  = 3;

  oneof data {
    HeartBeat heartBeat = 10;
    InstrumentDefinition instrumentDefinition = 11;
    InstrumentGroupStatus instrumentGroupStatus = 12;
    MarketSnapshot marketSnapshot = 13;
    MarketUpdate marketUpdate = 14;
    AdminMessage adminMessage = 15;

// Requests
    SubscriptionRequest subscriptionRequest = 30;
    SnapshotRequest snapshotRequest = 31;
    LoginRequest loginRequest = 32;
    LogoutRequest logoutRequest = 33;

// Responses
    SubscriptionResponse subscriptionResponse = 20;
    SnapshotResponse snapshotResponse = 21;
    UnexpectedMessageResponse unexpectedMessageResponse = 22;
    LoginResponse loginResponse = 23;
    LogoutResponse logoutResponse = 24;     
  }
}

/// Heart Beat
message HeartBeat {
  /// UTC timestamp of transaction, nano seconds since Unix epoch
  sint64 transactionTime = 1;
  string status = 2;
}


/// Instrument Group Status
message InstrumentGroupStatus {
  /// UTC Timestamp of transaction, nano seconds since Unix epoch
  sint64 transactionTime = 1;
  string instrumentGroupId = 2;
  InstrumentTradingStatus tradingStatus = 3;
  sint32 tradeDate = 4;
}

/// Snapshot for a market
message MarketSnapshot {

  /// Unique id identifying the market
  sint64 marketId = 1;
  // UTC Timestamp of transaction, nano seconds since Unix epoch
  sint64 transactionTime = 2;
  // Instrument level sequence number
  int64 marketSequence  = 3;
  /// Date only, format 2012-07-04 -> 20120704
  sint32 tradeDate = 4;

  /// A snapshot with market depth may exceed the maximum message size.
  //  In that case, the snapshot will be broken up across multiple
  //  snapshot messages.
  sint32 totalChunks = 5;
  sint32 currentChunk = 6;
  
  InstrumentStatus instrumentStatus = 10;
  
  // Best Bid Offer
  BestBidOffer bbo = 11;
  
  // Index Value
  IndexValue index = 12;
  
  // Price Level Book
  repeated AddPriceLevel priceLevels = 13;
  
  // Order Book
  repeated AddOrder orders = 14;
   News news = 15;

  /// Most recent opening price
  Open open = 30;

  /// High price for the trading session
  High high = 31;

  /// Low price for the trading session
  Low low = 32;

  /// Most recent closing price
  Close close = 33;

  /// Previous closing price
  PrevClose prevClose = 34;

  /// Most recent traded price and quantity
  Last last = 35;

  /// Year high price
  YearHigh yearHigh = 36;

  /// Year low price
  YearLow yearLow = 37;

  /// Total traded volume
  Volume volume = 38;

  /// Most recent settlement price
  Settlement settlement = 39;

  /// Most recent open interest
  OpenInterest openInterest = 40;

  /// Most recent volume weighted average price
   Vwap vwap = 41;

  DividendsIncomeDistributions dividendsIncomeDistributions = 42;
  NumberOfTrades numberOfTrades = 43;
  MonetaryValue monetaryValue = 44;
  CapitalDistributions capitalDistributions = 45;
  SharesOutstanding sharesOutstanding = 46;
  NetAssetValue netAssetValue = 47;

}

//
// Market Update for an instrument
//
message MarketUpdate {

  /// Unique id identifying the market
  sint64 marketId = 1;

  /// UTC Timestamp of transaction, nano seconds since Unix epoch
  sint64 transactionTime = 2;

  /// Market level sequencing number
  sint64 marketSequence = 3;

  // Market participant/originator
  string originatorId = 4;

  bytes reserved1 = 5;

  /// True if data is consolidated over many market participants/originators
  bool consolidated = 6;
  
  string reserved2 = 7;
   
  // data source sequence number
  sint64 sourceSequence = 8;

  /// Distribution time in nano seconds since epoch.  Used by CTA and UTP Plans
  sint64 distributionTime = 9;

  repeated Entry entry = 10;
  message Entry {
   oneof data {
         InstrumentStatus instrumentStatus = 1;
         BestBidOffer bbo = 2;
         AddPriceLevel addPriceLevel = 3;
         DeletePriceLevel deletePriceLevel = 4;
         ModifyPriceLevel modifyPriceLevel = 5;
         AddOrder addOrder = 6;
         DeleteOrder deleteOrder = 7;
         ModifyOrder modifyOrder = 8;
         IndexValue index = 9;
         Trade trade = 10;
         TradeCorrection tradeCorrection = 11;
         TradeCancel tradeCancel = 12;
         News news = 13;
         ClearBook clearBook = 14;

         // Statistics
         Open open = 30;
         High high = 31;
         Low low = 32;
         Close close = 33;
         PrevClose prevClose = 34;
         Last last = 35;
         YearHigh yearHigh = 36;
         YearLow yearLow = 37;
         Volume volume = 38;
         Settlement settlement = 39;
         OpenInterest openInterest = 40;
         Vwap vwap = 41;
         DividendsIncomeDistributions dividendsIncomeDistributions = 42;
         NumberOfTrades numberOfTrades = 43;
         MonetaryValue monetaryValue = 44;
         CapitalDistributions capitalDistributions = 45;
         SharesOutstanding sharesOutstanding = 46;
         NetAssetValue netAssetValue = 47;
    }
  }
}


// /////////////////////////////////////////////////////////////////
// Enums
// /////////////////////////////////////////////////////////////////

/// Book side
enum BookSide {
  UNKNOWN_BOOK_SIDE = 0;
  BID = 1;
  OFFER = 2;
}

enum InstrumentTradingStatus {
  UNKNOWN_TRADING_STATUS = 0;
  TRADING_RESUME = 1;
  PRE_OPEN = 2;
  OPEN = 3;
  PRE_CLOSE = 4;
  CLOSE = 5;
  TRADING_HALT = 6;
  QUOTATION_RESUME = 7;
  OPEN_DELAY = 8;
  NO_OPEN_NO_RESUME = 9;
  FAST_MARKET = 10;
  FAST_MARKET_END = 11;
  LATE_MARKET = 12;
  LATE_MARKET_END = 13;
  POST_SESSION = 14;
  POST_SESSION_END = 15;
}

enum RegulationSHOShortSalePriceTest {
  UNKNOWN_PRICE_TEST = 0;
  PRICE_TEST_NONE = 1;
  PRICE_TEST_IN_EFFECT = 2;
  PRICE_TEST_REMAINS_IN_EFFECT = 3;
}


enum SettlementTerms {
  UNKNOWN_SETTLEMENT_TERMS = 0;
  CASH = 1;
  NON_NET = 2;
  CONTINGENT_TRADE = 3;
  CASH_TODAY = 4;
  DATE = 5;
}

enum CrossType {
  UNKNOWN_CROSS_TYPE = 0;
  DEFAULT = 1;
  INTERNAL = 2;
  BASIS = 3;
  CONTINGENT = 4;
  SPECIAL = 5;
  VWAP = 6;
  REGULAR = 7;
}


//
// Instrument Status
//
message InstrumentStatus {
  InstrumentTradingStatus tradingStatus = 10;
  // UTC Timestamp, nano seconds since Unix epoch
  sint64 openingTime = 11;
  string note = 12;
  /// Date only, format 2012-07-04 -> 20120704
  sint32 tradeDate = 13;
  RegulationSHOShortSalePriceTest regulationSHOShortSalePriceTest = 14;
}


/// Best Bid and Offer.
// If a side is not present, then that side has been deleted.
//
message BestBidOffer {

  /// Divide by priceDenominator
  sint64 bidPrice = 10;

  /// Divide by quantityDenominator
  sint64 bidQuantity = 11;

  sint32 bidOrderCount = 12;

  /// Liquidity provider information
  // For Forex: BANK:CITY
  // For Equities: EXCHANGE_MIC
  string bidOriginator = 13;

  /// Divide by priceDenominator
  sint64 offerPrice = 20;

  /// Divide by quantityDenominator
  sint64 offerQuantity = 21;

  sint32 offerOrderCount = 22;

  /// Liquidity provider information
  // For Forex: BANK:CITY
  // For Equities: EXCHANGE_MIC
  string offerOriginator = 23;

  string quoteCondition = 30;

  bool nationalBboUpdated = 31;

}


/// Insert a new price level, pushing existing levels down
message AddPriceLevel {
  /// price level index, starting at 1
  sint32 level = 10;
  BookSide side = 11;

  /// Divide by priceDenominator
  sint64 price = 12;
  /// Divide by quantityDenominator
  sint64 quantity = 13;
  sint32 orderCount = 14;
  sint64 impliedQuantity = 15;
}

/// Delete an existing price level, pulling existing levels up
message DeletePriceLevel {
  /// price level index, starting at 1
  sint32 level = 10;
  BookSide side = 11;
}

/// Modify the quantity or orderCount of an existing price level.
/// The price itself will not change.
message ModifyPriceLevel {
  /// price level index, starting at 1
  sint32 level = 10;
  BookSide side = 11;
  /// Divide by priceDenominator
  sint64 price = 12;

  /// Divide by quantityDenominator
  sint64 quantity = 13;
  sint32 orderCount = 14;
  sint64 impliedQuantity = 15;
}

// Add an order to the order book.  Indexed by orderId, which is unique per channel
message AddOrder {
  sint64 orderId = 10;
  BookSide side = 11;
  sint64 price = 12;
  sint64 quantity = 13;
  bool isImplied = 14;
  sint64 priority = 15;
}

/// Delete an order from the order book. Indexed by orderId, which is unique per channel
message DeleteOrder {
  sint64 orderId = 10;
  BookSide side = 11;
}

/// Modify the price or quantity of an order.  The side and implied flag cannot change 
message ModifyOrder {
   sint64 orderId = 10;
   BookSide side = 11;
   sint64 price = 12;
   sint64 quantity = 13;
   bool isImplied = 14;
   sint64 priority = 15;
}


/// For non-tradable index products
message IndexValue {
  // Date only, format 2012-07-04 -> 20120704
  sint32 tradeDate = 10;
  sint64 last = 11;
  sint64 volume = 12;
  sint64 open = 13;
  sint64 settlementOpen = 14;
  sint64 specialOpen = 15;
  sint64 high = 16;
  sint64 low = 17;
  sint64 close = 18;
  sint64 bid = 19;
  sint64 offer = 20;
}


/// A live trade.  When received, update the "last" field
message Trade {

  /// Divide by priceDenominator
  sint64 price = 10;

  /// Divide by quantityDenominator
  sint64 quantity = 11;

  string tradeId = 12;
  
  /// The side of the aggressing order that caused the trade
  BookSide side = 13;
  /// Date only, format 2012-07-04 -> 20120704
  sint32 tradeDate = 14;
  string buyerId = 15;
  string sellerId = 16;
  bool openingTrade = 17;
  bool systemPriced = 18;
  bool marketOnClose = 19;
  bool oddLot = 20;
  SettlementTerms settlementTerms = 21;
  CrossType crossType = 22;
  bool byPass = 23;
  sint64 lastPrice = 24;
  string saleCondition = 25;
}

///  Trade Correction
message TradeCorrection {
  // Corrected Price
  sint64 price = 10;
  // Corrected Quantity
  sint64 quantity = 11;
  string tradeId = 12;
  BookSide side = 13;
  // Date only, format 2012-07-04 -> 20120704
  sint32 tradeDate = 14;
  string buyerId = 15;
  string sellerId = 16;
  bool openingTrade = 17;
  bool systemPriced = 18;
  bool marketOnClose = 19;
  bool oddLot = 20;
  SettlementTerms settlementTerms = 21;
  CrossType crossType = 22;
  bool byPass = 23;
  string originalTradeId = 24;
  string saleCondition = 25;
}

//
// Trade Cancel/Break
//
message TradeCancel {
  sint64 correctedTradePrice = 10;
  sint64 correctedTradeQuantity = 11;
  string tradeId = 12;
  string saleCondition = 13;
}

message Open {
  /// Date only, format 2012-07-04 -> 20120704
  sint32 tradeDate = 10;

  /// Divide by priceDenominator
  sint64 price = 11;
}
message High {
  /// Date only, format 2012-07-04 -> 20120704
  sint32 tradeDate = 10;

  /// Divide by priceDenominator
  sint64 price = 11;
}
message Low {
  /// Date only, format 2012-07-04 -> 20120704
  sint32 tradeDate = 10;

  /// Divide by priceDenominator
  sint64 price = 11;
}
message Close {
  /// Date only, format 2012-07-04 -> 20120704
  sint32 tradeDate = 10;

  /// Divide by priceDenominator
  sint64 price = 11;
}
message PrevClose {
  /// Date only, format 2012-07-04 -> 20120704
  sint32 tradeDate = 10;

  /// Divide by priceDenominator
  sint64 price = 11;
}

message Last {
  /// Date only, format 2012-07-04 -> 20120704
  sint32 tradeDate = 10;

  /// Divide by priceDenominator
  sint64 price = 11;

  /// Divide by quantityDenominator
  sint64 quantity = 12;
}

/// 52 week
message YearHigh {
  /// Divide by priceDenominator
  sint64 price = 10;
}

/// 52 week
message YearLow {
  /// Divide by priceDenominator
  sint64 price = 10;
}

/// Total volume traded
message Volume {
  /// Date only, format 2012-07-04 -> 20120704
  sint32 tradeDate = 10;

  // Total volume traded.
  sint64 volume = 11;
}

/// Total number of trades
message NumberOfTrades {
  /// Date only, format 2012-07-04 -> 20120704
  sint32 tradeDate = 10;
  sint64 numberTrades = 11;
}

/// Total monetary value of trades
message MonetaryValue {
  /// Date only, format 2012-07-04 -> 20120704
  sint32 tradeDate = 10;

  /// Divide by priceDenominator
  sint64 value = 11;

  string valueCurrencyCode = 12;
}

//// Settlement value for futures and options markets.
message Settlement {
  /// Date only, format 2012-07-04 -> 20120704
  sint32 tradeDate = 10;

  /// Divide by priceDenominator
  sint64 price = 11;
  bool preliminarySettle = 12;
  
  /// Reserved
  bool reserved = 127;
}

/// Open interest
message OpenInterest {
  // Date only, format 2012-07-04 -> 20120704
  sint32 tradeDate = 10;
  sint64 volume = 11;
}

/// Volume Weighted Average Price
message Vwap {
  // Date only, format 2012-07-04 -> 20120704
  sint32 tradeDate = 10;
  sint64 vwap = 11;
}

/// Dividends and Income Distributions
message DividendsIncomeDistributions {
  string instrumentType = 7;
  // Corporate Action
  string corporateAction = 8;
  // Distribution Type
  string distributionType = 9;

  // Date only, format 2012-07-04 -> 20120704
  sint32 payableDate = 10;
  sint32 recordDate = 11;
  sint32 exDividendDate = 12;
  // Cash amount of distribution
  sint64 amount = 13;
  string currencyCode = 14;
  repeated string notes = 15;
  //
  sint64 totalCashDistribution = 16;
  sint64 nonQualifiedCashDistribution = 17;
  sint64 qualifiedCashDistribution = 18;
  sint64 taxFreeCashDistribution = 19;
  sint64 ordinaryForeignTaxCredit = 20;
  sint64 qualifiedForeignTaxCredit = 21;
  sint64 stockDividendRatio = 22;
  //
  sint32 reinvestDate = 23;
  

}

/// Capital Distributions
message CapitalDistributions {
 string instrumentType = 9;
  // Corporate Action
  string corporateAction = 10;

  // Date only, format 2012-07-04 -> 20120704
  sint32 payableDate = 11;
  sint32 recordDate = 12;
  sint32 exDate = 13;

  // Distributions
  sint64 shortTermCapitalGain = 14;
  sint64 longTermCapitalGain = 15;
  sint64 unallocatedDistributions = 16;
  sint64 returnOfCapital = 17;

  string currencyCode = 18;
  repeated string notes = 19;
  //
  sint32 reinvestDate = 20;

}

//
message SharesOutstanding {
  sint64 sharesOutstanding = 1;
}
 
//
message NetAssetValue {
  sint64 netAssetValue = 1;
}


/// News or informational message
message News {
  // Origination time = UTC timestamp nano seconds since Unix epoch
  sint64 originationTime = 1;
  string source = 2;
  string languageCode = 3;
  string headLine = 4;
  string text = 5;
  repeated string symbols = 6;
}

/// Clear all data from the order books that are configured for this market.
message ClearBook {
   sint32 reserved = 1;
}

// Administrative Message
message AdminMessage {
  // Origination time = UTC timestamp nano seconds since Unix epoch
  sint64 originationTime = 1;
  string source = 2;
  string languageCode = 3;
  string headLine = 4;
  string text = 5;
}


/////////////
// Subscription messages
/////////////
message SnapshotRequest {
  sint64 correlationId = 1;
  
  /// Preferred service (realtime or delayed).
  Service service = 2;
  
  bool unsubscribe = 3;
  
  oneof request {
   sint64 marketId = 4;
  
  }
  
  /// Number of seconds in between snapshots
  // Zero means a single snapshot
  sint32 intervalSeconds = 127;
  
}

message SnapshotResponse {
  sint64 correlationId = 1;
  MarketSnapshot snapshot = 2;
  Result result = 3;
}

message UnexpectedMessageResponse {
  string message = 1;
}

message LoginRequest {
  sint64 correlationId = 1;
  string username = 2;
  string password = 3;
}

message LogoutRequest  {
  sint64 correlationId = 1;
}

message LoginResponse {
  sint64 correlationId = 1;
  
  Result result = 2;
  
}

message LogoutResponse {
  sint64 correlationId = 1;
  Result result = 2;
  string message = 3;
}

message SubscriptionResponse {
  sint64 correlationId = 1;
  Result result = 2;
  string message = 3;
  Service service = 4;
  sint64 marketId = 5;
}

message SubscriptionRequest {

  /// Client-assigned id for this request.  Response will include same id
  sint64 correlationId = 1;
  
  /// Preferred service (realtime or delayed).
  Service service = 2;
  
  bool unsubscribe = 3;
  
  oneof request {
   sint64 marketId = 4;
   string symbol = 5;
   sint32 channel = 6;
   string exchange = 7;
  }
  
  sint32 snapshotIntervalSeconds = 127;

}

enum Result {
  UNKNOWN_RESULT = 0;
  SUCCESS = 1;
  MALFORMED_MESSAGE = 120;
  UNEXPECTED_MESSAGE = 121;
  NOT_SUBSCRIBED = 122;
  DUPLICATE_SUBSCRIPTION = 123;
  INVALID_CREDENTIALS = 124;
  INSUFFICIENT_PRIVILEGES = 125;    
  AUTHENTICATION_REQUIRED = 126;    
  GENERIC_FAILURE = 127;
}


enum Service {
  UNKNOWN_SERVICE = 0;
  REAL_TIME = 1;
  DELAYED = 2;
  REAL_TIME_SNAPSHOT = 3;
  DELAYED_SNAPSHOT = 4;
}
